# 12장: I/O 프로젝트 – 커맨드 라인 프로그램 만들기

Rust로 `grep` 유사 프로그램 **minigrep**을 구현하면서 CLI 입력, 파일 I/O, 에러 처리, 환경 변수, 표준 출력/에러 등을 학습합니다.

---

## 1. 프로젝트 개요

* Rust의 **속도, 안정성, 단일 바이너리, 크로스플랫폼** 장점을 활용.
* `minigrep`: 파일에서 문자열을 검색하고 일치하는 줄 출력.
* 학습 포인트:

    * 모듈 분리, 벡터/문자열, 에러 처리, 제네릭/라이프타임, 테스트.
    * 환경 변수와 표준 에러 출력도 다룸.

---

## 2. 커맨드 라인 인수 처리

* 실행 예시:

  ```bash
  cargo run -- searchstring example.txt
  ```
* `std::env::args` → 반복자로 CLI 인수 획득 후 `collect`로 `Vec<String>` 변환.
* `args[1]` = 검색어, `args[2]` = 파일 경로.

---

## 3. 파일 읽기

* `std::fs::read_to_string(file_path)` 사용.
* 결과 타입: `Result<String>`.
* 내용 출력 확인 후 리팩터링 필요:

    * **문제**: `main`이 너무 많은 책임, 에러 메시지 단순.

---

## 4. 리팩터링과 에러 처리 개선

* **관심사 분리**:

    * `main.rs`: 실행 및 에러 처리.
    * `lib.rs`: 핵심 로직.
* `Config` 구조체: `query`, `file_path` 보관.
* `Config::build` → `Result<Config, &'static str>` 반환.
* `run(config)` 함수로 파일 처리 로직 이동.
* `Result`와 `?` 연산자 활용, 에러 시 `process::exit(1)` 반환.

---

## 5. 검색 기능 & 테스트 주도 개발

* **TDD 적용**:

    1. 실패 테스트 작성.
    2. 최소한의 코드로 통과.
    3. 리팩터링.
* `search(query, contents) -> Vec<&str>`

    * `contents.lines()` 반복
    * `line.contains(query)` 검사
    * 매칭 라인 반환
* 라이프타임 `'a` 명시 필요.
* `run()`에서 `search` 호출 후 결과 출력.

---

## 6. 환경 변수로 대소문자 무시 옵션 추가

* `search_case_insensitive` 함수 추가:

    * `query.to_lowercase()`, `line.to_lowercase()` 비교.
* `Config`에 `ignore_case: bool` 필드 추가.
* 환경 변수:

  ```rust
  let ignore_case = env::var("IGNORE_CASE").is_ok();
  ```
* `run`에서 `ignore_case` 값에 따라 적절한 search 함수 호출.

---

## 7. 표준 에러(`stderr`) 출력

* 기존 `println!`은 모두 **stdout**.
* 에러 메시지는 **stderr**로 출력해야 함.
* `eprintln!` 매크로 사용:

  ```rust
  eprintln!("Problem parsing arguments: {}", err);
  ```
* 장점:

    * 정상 결과(`stdout`)를 파일 리디렉션 가능.
    * 에러 메시지는 화면에 표시.

---

## 핵심 요약

* **minigrep** 구현을 통해 CLI 프로그램 설계 원칙 학습.
* 주요 기술:

    * `std::env::args`, `std::fs::read_to_string`, `Result` 기반 에러 처리.
    * `Config` 구조체로 인자 관리, `run` 함수로 로직 분리.
    * `assert_eq!`, TDD로 `search` 함수 검증.
    * 환경 변수(`IGNORE_CASE`)로 대소문자 무시 옵션 추가.
    * `eprintln!` 사용해 stderr 출력.
* 이 장은 Rust로 실무적인 CLI 툴을 작성하는 방법을 종합적으로 다룸.
