# 17장: 러스트와 객체 지향 프로그래밍

Rust는 **전통적인 OOP 언어는 아니지만**, 객체 지향 패러다임의 핵심 개념(객체, 캡슐화, 다형성)을 지원합니다. 이 장에서는 Rust에서 OOP 개념을 어떻게 구현하는지 다룹니다.

---

## 1. 객체 지향 언어의 특징

### 객체(Object)

* 데이터 + 메서드를 묶어 관리하는 개념.
* Rust의 구조체(`struct`), 열거형(`enum`) + `impl` 블록이 동일한 기능을 제공.

### 캡슐화(Encapsulation)

* 구현 세부사항을 감추고, **공개 API**만 노출.
* Rust에서는 `pub` 키워드로 접근 제어.
* 예: `AveragedCollection` 구조체는 내부 리스트와 평균값을 관리하고, `add/remove/average` 메서드만 외부에 노출.

### 상속(Inheritance) 대신 트레이트

* Rust에는 상속이 없음.
* **대안:**

    * **코드 재사용** → 트레이트의 기본 메서드 구현
    * **다형성** → 제네릭 + 트레이트 바운드 (bounded polymorphism)

---

## 2. 트레이트 객체와 다형성

### 문제

* 벡터(`Vec<T>`)는 단일 타입만 저장 가능.
* GUI 예제에서 `Button`, `TextField`, `SelectBox` 등을 같은 컬렉션에 담고 싶음.

### 해결

* **트레이트 객체 (`dyn Trait`)** 사용:

  ```rust
  pub trait Draw {
      fn draw(&self);
  }

  pub struct Screen {
      pub components: Vec<Box<dyn Draw>>,
  }

  impl Screen {
      pub fn run(&self) {
          for c in self.components.iter() {
              c.draw();
          }
      }
  }
  ```
* 런타임에 다양한 타입(`Button`, `SelectBox` 등)을 `Box<dyn Draw>`로 저장 가능.
* 이는 **동적 디스패치 (dynamic dispatch)** 로 동작하며, 약간의 런타임 비용이 있지만 유연성 제공.

### 비교

* **제네릭 + 트레이트 바운드**: 컴파일 타임 단형성화(빠름), 단일 타입만.
* **트레이트 객체**: 런타임에 다양한 타입 수용, 동적 디스패치 비용.

---

## 3. 객체 지향 디자인 패턴 – 상태 패턴(State Pattern)

Rust로 **상태 패턴**을 구현하는 예제를 블로그 게시물 워크플로우로 설명.

### 전통적 OOP 스타일

* `Post` 구조체 + 상태를 나타내는 `State` 트레이트
* 상태별 구조체 (`Draft`, `PendingReview`, `Published`) 구현
* `request_review()`, `approve()` 호출로 상태 전환
* `content()`는 상태에 따라 결과 달라짐

### Rust식 개선 – 타입 시스템 활용

* 상태를 **타입으로 인코딩**하여 유효하지 않은 상태 전환을 컴파일 타임에 방지.
* `DraftPost`, `PendingReviewPost`, `Post` 구조체를 별도로 두고, 메서드 체이닝으로 상태 전환:

  ```rust
  let post = DraftPost::new()
      .add_text("내용")
      .request_review()
      .approve();
  println!("{}", post.content());
  ```
* 장점: 잘못된 상태 사용 시 컴파일 에러 발생 → 더 안전함.

---

## 핵심 요약

* Rust는 **객체 지향 언어의 핵심 요소**를 제공:

    * **객체** → struct/enum + impl
    * **캡슐화** → 모듈 + `pub` 제어
    * **다형성** → 제네릭 + 트레이트 바운드, 또는 **트레이트 객체**
* 상속은 없지만, **트레이트**와 **컴포지션**으로 대체.
* 트레이트 객체(`dyn Trait`)는 동적 디스패치로 유연성을 제공.
* **상태 패턴**을 Rust에서 구현 가능하며, 타입 시스템을 활용하면 전통적 OOP보다 더 안전한 방식으로 설계할 수 있음.
