# 14장: 카고와 Crates.io 더 알아보기

Rust 생태계에서 **Cargo**와 **crates.io**는 핵심 역할을 합니다. 이 장에서는 기본적인 빌드/테스트 기능을 넘어서 Cargo의 고급 기능을 다룹니다.

---

## 1. 릴리즈 프로필 (Release Profiles)

* Cargo에는 **미리 정의된 프로필**이 있으며, `Cargo.toml`에서 커스터마이징 가능.
* 주요 프로필:

    * `dev`: `cargo build` 시 사용, 빠른 컴파일 중심 (`opt-level = 0`)
    * `release`: `cargo build --release` 시 사용, 실행 속도 중심 (`opt-level = 3`)
* 설정 예시:

  ```toml
  [profile.dev]
  opt-level = 1
  ```
* `opt-level`: 0\~3 (최적화 수준) → 속도와 컴파일 시간의 트레이드오프.

---

## 2. Crates.io에 크레이트 배포하기

### 문서화 주석

* `///` 문법으로 문서화 → `cargo doc --open` 실행 시 HTML 문서 생성.
* 예시 코드 포함 시 `cargo test`로 **문서 테스트** 자동 실행.
* 크레이트/모듈 단위 설명: `//!` 사용.

### API 개선 – `pub use`

* 내부 모듈 구조를 감추고 **공개 API 재구성** 가능.
* 예시: `pub use kinds::PrimaryColor;`

### Crates.io 등록 절차

1. [crates.io](https://crates.io) 계정 생성 및 API 토큰 발급.
2. `cargo login <TOKEN>` 실행.
3. `Cargo.toml`에 메타데이터 추가:

   ```toml
   [package]
   name = "guessing_game"
   version = "0.1.0"
   description = "A fun game..."
   license = "MIT OR Apache-2.0"
   ```
4. `cargo publish`로 배포.

    * 한 번 배포된 버전은 수정/삭제 불가 (영구 기록).
    * 문제 발생 시 `cargo yank --vers x.y.z`로 신규 프로젝트의 사용만 제한.

---

## 3. 카고 작업공간 (Workspaces)

* 여러 패키지를 하나의 **Cargo.lock과 target 디렉터리**로 관리.
* 예시 구조:

  ```
  add/
  ├── Cargo.toml (workspace 설정)
  ├── adder/ (binary crate)
  └── add_one/ (library crate)
  ```
* 특징:

    * 동일한 `Cargo.lock` → 모든 패키지가 같은 버전의 의존성 사용 보장.
    * `cargo run -p adder` → 특정 패키지 실행.
    * `cargo test` → 전체 워크스페이스 테스트 실행.
    * `cargo test -p add_one` → 특정 패키지 테스트 실행.

---

## 4. Crates.io에서 바이너리 설치 (`cargo install`)

* **바이너리 타겟**을 가진 패키지 설치 가능.
* 설치 위치: 기본적으로 `$HOME/.cargo/bin`
* `$PATH`에 추가해야 실행 가능.
* 예시: `ripgrep` 설치

  ```bash
  cargo install ripgrep
  rg --help
  ```

---

## 5. Cargo 확장 (Custom Commands)

* Cargo는 확장 가능한 구조:

    * `cargo-something` 형태의 실행 파일이 있으면 `cargo something`으로 실행 가능.
* `cargo --list`에 확장 명령어 포함됨.
* `cargo install`을 통해 확장 도구 설치 가능 (ex. `cargo-edit`, `cargo-watch` 등).

---

## 핵심 요약

* **릴리즈 프로필**: `dev`(빠른 빌드), `release`(최적화) → `Cargo.toml`에서 커스터마이징 가능.
* **Crates.io 배포**: 문서화, `pub use`로 API 정리, `cargo publish`로 배포. 버전 삭제는 불가하나 `yank`로 비활성화 가능.
* **워크스페이스**: 여러 패키지를 하나의 프로젝트처럼 관리, 의존성 공유 및 테스트 통합.
* **cargo install**: 커뮤니티 도구 쉽게 설치, `$HOME/.cargo/bin`에서 실행.
* **커스텀 명령어**: `cargo-something` 실행 파일을 통해 Cargo 확장 가능.
